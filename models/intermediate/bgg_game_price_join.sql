{{config(materialized="table")}}

SELECT 
    master_bgg.id,
    game_name,
    published_year,
    year,
    min_players,
    max_players,
    age_min,
    categories,
    mechanics,
    family,
    designer,
    artist,
    publisher,
    nb_of_ratings,
    avg_rating,
    bayes_avg,
    owned,
    people_wishing,
    nb_weights,
    avg_difficulty,
    bgg_rank,
    difficulty,
    engagement_rate,
    type,
    difficulty_sorting,
    min_players_sorting,
    min_players_intervals,
    max_players_sorting,
    max_players_intervals,
    game_duration_sorting,
    game_duration_intervals,
    price_aggreg.product as mean_price,
    ROUND(price_aggreg.product / master_bgg.avg_rating , 2) AS price_over_quality,
    ROUND(price_aggreg.product * master_bgg.owned, 2) AS estimated_turnover,
FROM {{ ref('master_bgg') }} as master_bgg
LEFT JOIN {{ ref('price_aggreg_by_game') }} AS price_aggreg
    USING(id)